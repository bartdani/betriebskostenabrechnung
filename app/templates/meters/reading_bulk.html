{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h1>{{ title }}</h1>

  <form method="GET" action="{{ url_for('meters.create_meter_readings_bulk') }}" class="row g-3 mt-2">
    <div class="col-md-6">
      <label class="form-label">Wohnung</label>
      <select name="apartment_id" class="form-select" onchange="this.form.submit()">
        <option value="">Bitte wählen …</option>
        {% for a in apartments %}
          <option value="{{ a.id }}" {% if selected_apartment and selected_apartment.id == a.id %}selected{% endif %}>{{ a.number }} — {{ a.address }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  {% if selected_apartment %}
  <form method="POST" action="{{ url_for('meters.create_meter_readings_bulk', apartment_id=selected_apartment.id) }}" class="mt-3">
    <div class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Datum</label>
        <input type="date" name="date" class="form-control" required />
      </div>
      <div class="col-md-9 d-flex align-items-end">
        <button type="submit" class="btn btn-primary">Alle speichern</button>
      </div>
    </div>

    <div class="table-responsive mt-3">
      <table class="table table-sm align-middle">
        <thead>
          <tr>
            <th>Zähler</th>
            <th>Typ</th>
            <th>Einheit</th>
            <th>Wert</th>
          </tr>
        </thead>
        <tbody>
          {% for m in meters %}
          <tr>
            <td>{{ m.serial_number }}</td>
            <td>{{ m.meter_type }}</td>
            <td>{{ m.unit }}</td>
            <td style="max-width: 10rem;"><input type="number" step="0.0001" class="form-control" name="value_{{ m.id }}" placeholder="Wert" /></td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4">Keine Zähler für diese Wohnung gefunden.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
  {% endif %}
</div>
{% endblock %}


